<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculator</title>
  <style>
    :root{
      --bg: #0f172a;
      --panel: #111827;
      --screen: #0b1220;
      --btn: #1f2937;
      --btn2:#243244;
      --accent:#22c55e;
      --danger:#ef4444;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background: radial-gradient(1100px 600px at 20% 10%, #1d2a5a 0%, transparent 60%),
                  radial-gradient(900px 500px at 80% 90%, #0f766e 0%, transparent 55%),
                  var(--bg);
      color:var(--text);
      font: 16px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      padding: 18px;
    }

    .calculator{
      width: min(360px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 6px 6px 10px;
      color: var(--muted);
      font-size: 13px;
      letter-spacing: .2px;
    }

    .screen{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .expr{
      min-height: 18px;
      color: var(--muted);
      text-align:right;
      font-size: 13px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .result{
      text-align:right;
      font-size: 34px;
      font-weight: 700;
      padding-top: 6px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .keys{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    button{
      appearance:none;
      border:none;
      border-radius: 14px;
      padding: 14px 10px;
      font-size: 18px;
      font-weight: 650;
      color: var(--text);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      background-color: var(--btn);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 8px 18px rgba(0,0,0,.22);
      cursor:pointer;
      transition: transform .06s ease, filter .15s ease, background-color .15s ease;
      user-select:none;
    }

    button:hover{ filter: brightness(1.08); }
    button:active{ transform: translateY(1px) scale(.99); }

    .op{ background-color: var(--btn2); }
    .equal{
      background-color: rgba(34,197,94,.20);
      border-color: rgba(34,197,94,.45);
    }
    .danger{
      background-color: rgba(239,68,68,.18);
      border-color: rgba(239,68,68,.45);
    }
    .span-2{ grid-column: span 2; }

    .hint{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      text-align:center;
    }
    kbd{
      font: inherit;
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      color: var(--text);
    }
  </style>
</head>

<body>
  <main class="calculator" aria-label="Calculator">
    <div class="brand">
      <span>Mini Calculator</span>
      <span>HTML • CSS • JS</span>
    </div>

    <div class="screen" role="region" aria-label="Display">
      <div class="expr" id="expr"></div>
      <div class="result" id="result">0</div>
    </div>

    <div class="keys" aria-label="Keys">
      <button class="danger" data-action="clear">AC</button>
      <button class="danger" data-action="delete">DEL</button>
      <button class="op" data-value="(">(</button>
      <button class="op" data-value=")">)</button>

      <button data-value="7">7</button>
      <button data-value="8">8</button>
      <button data-value="9">9</button>
      <button class="op" data-value="/">÷</button>

      <button data-value="4">4</button>
      <button data-value="5">5</button>
      <button data-value="6">6</button>
      <button class="op" data-value="*">×</button>

      <button data-value="1">1</button>
      <button data-value="2">2</button>
      <button data-value="3">3</button>
      <button class="op" data-value="-">−</button>

      <button class="span-2" data-value="0">0</button>
      <button data-value=".">.</button>
      <button class="op" data-value="+">+</button>

      <button class="equal span-2" data-action="equals">=</button>
      <button class="op" data-value="%">%</button>
      <button class="op" data-action="toggle-sign">±</button>
    </div>

    <div class="hint">
      Tip: Use keyboard <kbd>0-9</kbd> <kbd>+</kbd> <kbd>-</kbd> <kbd>*</kbd> <kbd>/</kbd> <kbd>Enter</kbd> <kbd>Backspace</kbd>
    </div>
  </main>

  <script>
    const exprEl = document.getElementById("expr");
    const resultEl = document.getElementById("result");

    let expr = "";

    function render(preview = true) {
      exprEl.textContent = expr;

      if (!preview) return;

      // Live preview when expression is valid-ish
      try {
        if (expr.trim() === "") {
          resultEl.textContent = "0";
          return;
        }
        const val = safeEval(expr);
        if (Number.isFinite(val)) resultEl.textContent = formatNumber(val);
      } catch {
        // keep last shown result
      }
    }

    function formatNumber(n) {
      // avoid ugly long floats
      const rounded = Math.round((n + Number.EPSILON) * 1e10) / 1e10;
      return String(rounded);
    }

    function safeEval(input) {
      // Basic sanitization: allow digits, operators, parentheses, decimal point, spaces, and %
      // Convert percent: "50%" -> "(50/100)"
      const sanitized = input
        .replace(/[^0-9+\-*/().%\s]/g, "")
        .replace(/(\d+(\.\d+)?)%/g, "($1/100)");

      // Evaluate in a contained function scope
      // Note: This is okay for a simple demo; for production, use a real parser.
      return Function('"use strict"; return (' + sanitized + ')')();
    }

    function append(val) {
      expr += val;
      render(true);
    }

    function clearAll() {
      expr = "";
      resultEl.textContent = "0";
      render(false);
    }

    function del() {
      expr = expr.slice(0, -1);
      render(true);
    }

    function toggleSign() {
      // Toggle sign of the last number in the expression
      const m = expr.match(/(.*?)(-?\d+(\.\d+)?)\s*$/);
      if (!m) return;
      const before = m[1];
      const num = m[2];
      const flipped = num.startsWith("-") ? num.slice(1) : "-" + num;
      expr = before + flipped;
      render(true);
    }

    function equals() {
      try {
        const val = safeEval(expr);
        if (!Number.isFinite(val)) throw new Error("Bad result");
        resultEl.textContent = formatNumber(val);
        expr = String(formatNumber(val));
        render(false);
      } catch {
        resultEl.textContent = "Error";
      }
    }

    document.querySelector(".keys").addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const action = btn.dataset.action;
      const value = btn.dataset.value;

      if (action === "clear") return clearAll();
      if (action === "delete") return del();
      if (action === "equals") return equals();
      if (action === "toggle-sign") return toggleSign();
      if (value) return append(value);
    });

    // Keyboard support
    window.addEventListener("keydown", (e) => {
      const k = e.key;

      if ((k >= "0" && k <= "9") || ["+", "-", "*", "/", "(", ")", "."].includes(k)) {
        append(k);
        return;
      }

      if (k === "Enter" || k === "=") {
        e.preventDefault();
        equals();
        return;
      }

      if (k === "Backspace") {
        del();
        return;
      }

      if (k === "Escape") {
        clearAll();
        return;
      }

      if (k === "%") {
        append("%");
      }
    });

    render(false);
  </script>
</body>
</html>
